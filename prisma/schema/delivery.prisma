// 配達グループ
model SbmDeliveryGroup {
  id                  Int                       @id @default(autoincrement())
  name                String
  deliveryDate        DateTime
  userId              Int
  userName            String
  status              String                    @default("planning") // planning, route_generated, in_progress, completed
  totalReservations   Int                       @default(0)
  completedReservations Int                     @default(0)
  estimatedDuration   Int?
  actualDuration      Int?
  routeUrl            String?
  notes               String?
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  optimizedRoute      SbmDeliveryRouteStop[]
  groupReservations   SbmDeliveryGroupReservation[]

  @@map("sbm_delivery_groups")
}

// 配達ルートの停止地点
model SbmDeliveryRouteStop {
  id                  String                    @id @default(uuid())
  deliveryGroupId     Int
  reservationId       Int
  customerName        String
  address             String
  lat                 Float?
  lng                 Float?
  estimatedArrival    DateTime?
  actualArrival       DateTime?
  deliveryOrder       Int
  deliveryCompleted   Boolean                   @default(false)
  recoveryCompleted   Boolean                   @default(false)
  estimatedDuration   Int
  notes               String?
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  deliveryGroup       SbmDeliveryGroup         @relation(fields: [deliveryGroupId], references: [id], onDelete: Cascade)

  @@map("sbm_delivery_route_stops")
}

// 配達グループと予約の紐付け
model SbmDeliveryGroupReservation {
  id                  Int                       @id @default(autoincrement())
  deliveryGroupId     Int
  reservationId       Int
  deliveryOrder       Int?
  isCompleted         Boolean                   @default(false)
  completedAt         DateTime?
  notes               String?
  createdAt           DateTime                  @default(now())
  deliveryGroup       SbmDeliveryGroup         @relation(fields: [deliveryGroupId], references: [id], onDelete: Cascade)
  reservation         SbmReservation            @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@unique([deliveryGroupId, reservationId])
  @@map("sbm_delivery_group_reservations")
}